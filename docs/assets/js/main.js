const listResult=document.querySelector(".js-list-result"),listFavourites=document.querySelector(".js-list-favourites"),searchBtn=document.querySelector(".js-search-btn"),resetBtn=document.querySelector(".js-reset-btn"),resetFavouritesBtn=document.querySelector(".js-resetFavourites-btn"),favouritesPlaceholder=document.querySelector(".js-placeholder-favourites-text"),resultsPlaceholder=document.querySelector(".js-placeholder-results-text"),logBtn=document.querySelector(".js-log-btn");let resultSearch,firstRender=!0,favouriteAnimes=JSON.parse(localStorage.getItem("favourites"))||[];function getAnimes(e){fetch("https://api.jikan.moe/v3/search/anime?q="+e).then(e=>e.json()).then(e=>{resultsPlaceholder.classList.add("hidden"),listResult.classList.remove("hidden"),resultSearch=e.results.map(e=>e),resultSearch.forEach(e=>{createAnimeCard(e,listResult,"❤")})})}function createAnimeCard(e,t,s){const r=e.image_url||"https://via.placeholder.com/210x295/ffffff/666666/?text=TV",i=e.title,a=e.mal_id;e.score;let l=searchAnimeById(a,favouriteAnimes);const n=document.createElement("li"),o=document.createElement("h3"),d=document.createElement("img"),c=document.createElement("button"),u=document.createElement("div");c.innerText=s,c.classList.add("btn","btn--like"),u.classList.add("card__container"),o.innerText=i,n.style.backgroundImage=`url(${r})`,d.src=r,d.classList.add("card__img"),o.classList.add("card__title"),n.append(u),u.append(c,o),n.dataset.id=a,n.classList.add("card"),t===listFavourites&&n.classList.add("favourite"),t.appendChild(n),addFavouriteClass(n,l),t===listResult&&c.addEventListener("click",t=>{let s=searchAnimeById(t.currentTarget.dataset.id,favouriteAnimes);t.currentTarget.classList.toggle("favourite"),handleFavourites(e,s)}),t!==listResult&&c.addEventListener("click",e=>{const t=e.currentTarget.parentNode.dataset.id;deleteFavourite(t);listResult.querySelector(`[data-id="${t}"]`).classList.remove("favourite")})}function handleFavourites(e,t){const s=e.mal_id;t?deleteFavourite(s):t||setFavourite(s,t),renderFavourites(e,t)}function setFavourite(e,t){const s=resultSearch.find(t=>t.mal_id===e);t||(favouriteAnimes.push(s),localStorage.setItem("favourites",JSON.stringify(favouriteAnimes)))}function addFavouriteClass(e,t){t&&e.classList.add("favourite")}function renderFavourites(e,t){listFavourites.classList.remove("hidden"),favouritesPlaceholder.classList.add("hidden"),firstRender?(createAnimeCard(e,listFavourites,"X"),firstRender=!1):t||createAnimeCard(e,listFavourites,"X")}function deleteFavourite(e){const t=favouriteAnimes.findIndex(t=>t.mal_id===parseInt(e));favouriteAnimes.splice(t,1),localStorage.removeItem("favourites"),localStorage.setItem("favourites",JSON.stringify(favouriteAnimes)),listFavourites.innerHTML="",0===favouriteAnimes.length&&(listFavourites.classList.add("hidden"),favouritesPlaceholder.classList.remove("hidden")),favouriteAnimes.forEach(e=>{createAnimeCard(e,listFavourites,"X")})}function searchAnimeById(e,t){return!!t.find(t=>t.mal_id===parseInt(e))}function resetList(e){e.replaceChildren()}favouriteAnimes.forEach(e=>renderFavourites(e)),0!==listFavourites.childNodes.length&&(favouritesPlaceholder.classList.add("hidden"),listFavourites.classList.remove("hidden")),searchBtn.addEventListener("click",e=>{const t=document.querySelector("#anime").value;e.preventDefault(),resetList(listResult),getAnimes(t)}),resetBtn.addEventListener("click",()=>{resetList(listResult),resultsPlaceholder.classList.remove("hidden"),listResult.classList.add("hidden")}),resetFavouritesBtn.addEventListener("click",()=>{resetList(listFavourites),favouritesPlaceholder.classList.remove("hidden"),listFavourites.classList.add("hidden"),favouriteAnimes=[],localStorage.removeItem("favourites"),listResult&&listResult.querySelectorAll("li").forEach(e=>{e.classList.remove("favourite")})});