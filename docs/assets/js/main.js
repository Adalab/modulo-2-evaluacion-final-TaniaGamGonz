const listResult=document.querySelector(".js-list-result"),listFavourites=document.querySelector(".js-list-favourites"),searchBtn=document.querySelector(".js-search-btn"),resetBtn=document.querySelector(".js-reset-btn"),resetFavouritesBtn=document.querySelector(".js-resetFavourites-btn");let resultSearch,firstRender=!0,favouriteAnimes=JSON.parse(localStorage.getItem("favourites"))||[];function getAnimes(e){fetch("https://api.jikan.moe/v3/search/anime?q="+e).then(e=>e.json()).then(e=>{resultSearch=e.results.map(e=>e),resultSearch.forEach(e=>{createAnimeCard(e,listResult,"AÃ±adir a series favoritas")})})}function resetList(e){e.replaceChildren()}function addFavouriteClass(e,t){t&&e.classList.add("favourite")}function handleFavourites(e,t){const r=e.mal_id;t?deleteFavourite(r):t||setFavourite(r,t),renderFavourites(e,t)}function setFavourite(e,t){const r=resultSearch.find(t=>t.mal_id===e);t||(favouriteAnimes.push(r),localStorage.setItem("favourites",JSON.stringify(favouriteAnimes)))}function searchAnimeById(e,t){return!!t.find(t=>t.mal_id===parseInt(e))}function renderFavourites(e,t){firstRender?(createAnimeCard(e,listFavourites,"Borrar de favoritos"),firstRender=!1):t||createAnimeCard(e,listFavourites,"Borrar de favoritos")}function deleteFavourite(e){const t=favouriteAnimes.findIndex(t=>t.mal_id===parseInt(e));favouriteAnimes.splice(t,1),localStorage.removeItem("favourites"),localStorage.setItem("favourites",JSON.stringify(favouriteAnimes)),listFavourites.innerHTML="",favouriteAnimes.forEach(e=>{createAnimeCard(e,listFavourites,"Borrar de favoritos")})}function createAnimeCard(e,t,r){const s=e.image_url||"https://via.placeholder.com/210x295/ffffff/666666/?text=TV",a=e.title,i=e.mal_id;let n=searchAnimeById(i,favouriteAnimes);const o=document.createElement("li"),c=document.createElement("h3"),u=document.createElement("img"),l=document.createElement("button");l.innerText=r,l.classList.add("btn"),c.innerText=a,c.classList.add("card__title"),u.src=s,u.classList.add("card__img"),o.append(c,u,l),o.dataset.id=i,o.classList.add("card"),t===listFavourites&&o.classList.add("favourite"),t.appendChild(o),addFavouriteClass(o,n),t===listResult&&o.addEventListener("click",t=>{let r=searchAnimeById(t.currentTarget.dataset.id,favouriteAnimes);t.currentTarget.classList.toggle("favourite"),handleFavourites(e,r)}),l.addEventListener("click",e=>{const t=e.currentTarget.parentNode.dataset.id;deleteFavourite(t);listResult.querySelector(`[data-id="${t}"]`).classList.remove("favourite")})}favouriteAnimes.forEach(e=>renderFavourites(e)),searchBtn.addEventListener("click",e=>{const t=document.querySelector("#anime").value;e.preventDefault(),resetList(listResult),getAnimes(t)}),resetBtn.addEventListener("click",()=>{resetList(listResult)}),resetFavouritesBtn.addEventListener("click",()=>{resetList(listFavourites),favouriteAnimes=[],localStorage.removeItem("favourites")});