const listResult=document.querySelector(".js-list-result"),listFavourites=document.querySelector(".js-list-favourites"),searchBtn=document.querySelector(".js-search-btn"),resetBtn=document.querySelector(".js-reset-btn"),resetFavouritesBtn=document.querySelector(".js-resetFavourites-btn");let resultSearch,firstRender=!0,favouriteAnimes=JSON.parse(localStorage.getItem("favourites"))||[];function getAnimes(e){fetch("https://api.jikan.moe/v3/search/anime?q="+e).then(e=>e.json()).then(e=>{resultSearch=e.results.map(e=>e),resultSearch.forEach(e=>{createAnimeCard(e,listResult,"AÃ±adir a series favoritas")})})}function resetList(e){e.replaceChildren()}function chekcIfItsFavourite(e,t){favouriteAnimes.find(t=>t.mal_id===e)&&t.classList.add("favourite")}function createAnimeCard(e,t,r){const s=e.image_url||"https://via.placeholder.com/210x295/ffffff/666666/?text=TV",i=e.title,a=e.mal_id,n=document.createElement("li"),c=document.createElement("h3"),o=document.createElement("img"),u=document.createElement("button");u.innerText=r,u.classList.add("btn"),c.innerText=i,c.classList.add("card__title"),o.src=s,o.classList.add("card__img"),n.append(c,o,u),n.dataset.id=a,n.classList.add("card"),t===listFavourites&&n.classList.add("favourite"),t.appendChild(n),chekcIfItsFavourite(a,n),n.addEventListener("click",e=>{setFavourite(e.currentTarget.dataset.id),e.currentTarget.classList.toggle("favourite")})}function setFavourite(e){const t=searchAnimeById(e,favouriteAnimes),r=searchAnimeById(e,resultSearch);renderFavourites(r),t||(favouriteAnimes.push(r),localStorage.setItem("favourites",JSON.stringify(favouriteAnimes)))}function searchAnimeById(e,t){return t.find(t=>t.mal_id===parseInt(e))}function renderFavourites(e){const t=searchAnimeById(e.mal_id,favouriteAnimes);firstRender?createAnimeCard(e,listFavourites,"Borrar de favoritos"):t||createAnimeCard(e,listFavourites,"Borrar de favoritos")}favouriteAnimes.forEach(e=>renderFavourites(e)),searchBtn.addEventListener("click",e=>{const t=document.querySelector("#anime").value;e.preventDefault(),resetList(listResult),getAnimes(t)}),resetBtn.addEventListener("click",()=>{resetList(listResult)}),resetFavouritesBtn.addEventListener("click",()=>{resetList(listFavourites),favouriteAnimes=[],localStorage.removeItem("favourites")});